# Category 1A Testing Notes
> Sanity check + [hardcoded] static `poolConfig`

Overall, the Content Coins work as intended, but Creator Coins do not work as expected. Jump to 
[result](#actual-results) below.

## Preface
> See [reference txns](./reference_txns.md) for more details

Going off of a test Zora account ([khaaliDimaag](https://zora.co/@khaalidimaag)), we follow similar
structures and expect to programmatically create a new user on Zora, a Creator Coin for that user,
and then award the user a Content Coin (as described under the [Token Tuner](../README.md#token-tuner))
use case.

### Important Values

| key | value | notes |
| :---: | :---: | --- |
| name | `khaalidimaag` | |
| symbol / ticker | `khaalidimaag` | |
| Creator Coin | [`0x089A2476A94efa119f1623177d016fF7a851A970`](https://basescan.org/address/0x089A2476A94efa119f1623177d016fF7a851A970) | 3 owners |
| Zora Account / Smart Wallet | [`0x9E8Bb57FA5154a83cF385a101BD0450f16ef6361`](https://basescan.org/address/0x9E8Bb57FA5154a83cF385a101BD0450f16ef6361) | Owner 01 |
| Privy EOA | [`0xcb952d3BeA0D7018EE21dBA7BCeA7EC31bbFdF92`](https://basescan.org/address/0xcb952d3BeA0D7018EE21dBA7BCeA7EC31bbFdF92) | Owner 02 |
| Personal EOA | [`0x9378Bc37A3d5668AdB1377dF6c2F8e23A95bcDDe`](https://basescan.org/address/0x9378Bc37A3d5668AdB1377dF6c2F8e23A95bcDDe) | Owner 03 |

**creator coin metadata**
```json
{
  "name": "khaalidimaag",
  "ticker": "khaalidimaag",
  "image": "ipfs://bafybeif7qcvontou4fxw7bz6a5ysxmylln2mp3ia7mnp2gwfap6nbb24xa",
  "content": {
    "uri": "ipfs://bafybeif7qcvontou4fxw7bz6a5ysxmylln2mp3ia7mnp2gwfap6nbb24xa"
  }
}
```


### Key Observation
> Owners of a creator coin redirect to username on zora

If we go to `https://zora.co/@0x9E8Bb57FA5154a83cF385a101BD0450f16ef6361` or 
`https://zora.co/@0xcb952d3BeA0D7018EE21dBA7BCeA7EC31bbFdF92` or 
`https://zora.co/@0x9378Bc37A3d5668AdB1377dF6c2F8e23A95bcDDe`, the page redirects to 
`https://zora.co/@khaalidimaag`, which is ideal.

In the end, we want to create new users on the Zora Protocol, and conditionally award some content 
to them as a means of incentivising good behaviour. See more under the [Token 
Tuner](../README.md#token-tuner) use case.

### Important

Zora's [docs](https://docs.zora.co/coins/contracts/creating-a-coin#direct-contract-integration) 
state that _The `msg.sender` that calls the deployment function is considered the creator of the 
coin._ As such, the code is strucutred to have User accounts include 
[Callbacks](../src/user/ZoraCallbacks.sol) so that the final call to Zora Factory goes from the 
user.

## Expectation
> tl;dr flow :: Admin -> UserFactory ;; Admin -> User -> _Zora callback_

Initially, [Admin](../src/Admin.sol) and [UserFactory](../src/user/UserFactory.sol) contracts are 
set up. Post which, a new User is _onboarded_, which includes creating a new User and having that 
User call `ZoraFactory.deployCreatorCoin(...)`, so that the User may have a valid Creator Coin.

Finally, over the course of dApp usage, whenever appropriate, new Content is awarded to the user 
by the Admin, which entails having the specific User contract call `ZoraFactory.deploy(...)`, so 
that the User is registered as the creator of the Coin. Note that the Admin contract is still one 
of the owners since they can then manage the tokenURI, a "handicap" that should be removed in prod.

### Onboarding a User

Two contracts should be created, the User and the associated Creator Coin. The owners of the 
Creator Coin should be the User contract and the Admin contract.

Additionally, `https://zora.co/@<user-address>` should redirect to `https://zora.co/@<user-name>`, 
and the website should correctly display the profile image and associated creator coin.

### Awarding Content

A CoinV4 contract should be created, with the relevant User being considered a creator of the Coin,
along with the image and description being shown properly, as per the json on ipfs.

## Actual Results

Over all, the Content Coins work as intended, but user registration and Creator Coins do not work 
as expected at all. This is a problem.

> [!IMPORTANT]
> Having said that, on basescan, everything appears to be in good order. So, the core issue is that 
Zora's website is not indexing and displaying information as expected / needed / wanted. Unsure 
how to resolve this.

dApp addresses,
- Admin Contract :: [`0x646DE5f446c1287bF41B737BA541318EF97aF222`](https://basescan.org/address/0x646de5f446c1287bf41b737ba541318ef97af222)
- User Factory :: [`0xe0fa3a53eba5686d39a102abcc4b4805ee7ece36`](https://basescan.org/address/0xe0fa3a53eba5686d39a102abcc4b4805ee7ece36)

### User 01 ~ goku.ZT
> Txn hash :: [`0xa9a149eef4c38cb612c0ab00c0637f70e07d2df0a494df5845aca5cd4374638f`](https://basescan.org/tx/0xa9a149eef4c38cb612c0ab00c0637f70e07d2df0a494df5845aca5cd4374638f)

- User Contract :: [`0xc66c986afece1825027597decc92363cebbf1101`](https://basescan.org/address/0xc66c986afece1825027597decc92363cebbf1101)
- Creator Coin :: [`0xc66Ab166e5a4c67c95ecbF62F728EE437cB7a78B`](https://basescan.org/address/0xc66ab166e5a4c67c95ecbf62f728ee437cb7a78b)
- Currency :: [`0x1111111111166b7FE7bd91427724B487980aFc69`](https://basescan.org/address/0x1111111111166b7FE7bd91427724B487980aFc69) (ie, $ZORA)
- Creator Coin IPFS :: [`ipfs://bafkreibzd3meziylhx26cdarwtvgmbjh6lxt3ecdkyfvw4kbx36wccmmm4`](https://ipfs.io/ipfs/bafkreibzd3meziylhx26cdarwtvgmbjh6lxt3ecdkyfvw4kbx36wccmmm4)
- Creator Coin Owners 
  - `0xc66c986AfecE1825027597deCC92363CebBF1101` (User, goku.ZT)
  - `0x646DE5f446c1287bF41B737BA541318EF97aF222` (Admin)
- Zora Profile :: https://zora.co/@0xc66c986AfecE1825027597deCC92363CebBF1101


### User 02 ~ vegeta.ZT
> Txn hash :: [`0x316d52777939cf681733bd101a52677c814c4d9777a82e5022a9639ee8ca233b`](https://basescan.org/tx/0x316d52777939cf681733bd101a52677c814c4d9777a82e5022a9639ee8ca233b)

- User Contract :: [`0x58613872f8ec8623a6d9041ef8422946d7327e40`](https://basescan.org/address/0x58613872f8ec8623a6d9041ef8422946d7327e40)
- Creator Coin :: [`0xfe43ebeffcef6cc166f00959588bceefad71f821`](https://basescan.org/address/0xfe43ebeffcef6cc166f00959588bceefad71f821)
- Currency :: [`0x1111111111166b7FE7bd91427724B487980aFc69`](https://basescan.org/address/0x1111111111166b7FE7bd91427724B487980aFc69) (ie, $ZORA)
- Creator Coin IPFS :: [`ipfs://bafkreibvdwmqdcvy3fjvirj63rh72boo3jwgo4jffiimydi5djlefjblt4`](https://ipfs.io/ipfs/bafkreibvdwmqdcvy3fjvirj63rh72boo3jwgo4jffiimydi5djlefjblt4)
- Creator Coin Owners 
  - `0x58613872F8eC8623A6D9041eF8422946D7327E40` (User)
  - `0x646DE5f446c1287bF41B737BA541318EF97aF222` (Admin)
- Zora Profile :: https://zora.co/@0x58613872f8ec8623a6d9041ef8422946d7327e40

### Content Coins

These work as expected, showing up correctly on the site. Unsure if they show up on the feed yet, 
but presumably they will. One bug in naming the Coin, but that's more an issue of my code than 
something on Zora's end.

**Content Coin 01**
> Txn hash :: [`0x5e317d95d29ac547e11ab572c61468aafb6a368d71c52e504d57e233062f66a7`](https://basescan.org/tx/0x5e317d95d29ac547e11ab572c61468aafb6a368d71c52e504d57e233062f66a7)

- Coin Contract :: [`0x4d237f6d484e9adba7b1f1c656a718a47379c67f`](https://basescan.org/address/0x4d237f6d484e9adba7b1f1c656a718a47379c67f)
- Currency :: [`0xc66Ab166e5a4c67c95ecbF62F728EE437cB7a78B`](https://basescan.org/address/0xc66Ab166e5a4c67c95ecbF62F728EE437cB7a78B) (ie, Creator Coin of [`goku.ZT`](#user-01--gokuzt))
- Content Coin IPFS :: [`ipfs://bafkreiglz4kleybyya5itsicek3nkpvzo5dz7jc3zc5j5xim7wkqewhc6a`](https://ipfs.io/ipfs/bafkreiglz4kleybyya5itsicek3nkpvzo5dz7jc3zc5j5xim7wkqewhc6a)
- Content Coin Owners
  - `0xc66c986AfecE1825027597deCC92363CebBF1101` (User, goku.ZT)
  - `0x646DE5f446c1287bF41B737BA541318EF97aF222` (Admin)
- Zora Link :: https://zora.co/coin/base:0x4d237f6d484e9adba7b1f1c656a718a47379c67f

**Content Coin 02**
> Txn hash :: [`0xb8b74db5bb15b95746f19e2b52d2c97b70bbea27a24c0e1567b539b9ba9a0476`](https://basescan.org/tx/0xb8b74db5bb15b95746f19e2b52d2c97b70bbea27a24c0e1567b539b9ba9a0476)

- Coin Contract :: [`0x12118f0cb58fda162b407a9f02242d15415262ec`](https://basescan.org/address/0x12118f0cb58fda162b407a9f02242d15415262ec)
- Currency :: [`0xFe43EbeFfcef6cC166f00959588bCeefAd71f821`](https://basescan.org/address/0xFe43EbeFfcef6cC166f00959588bCeefAd71f821) (ie, Creator Coin of [`vegeta.ZT`](#user-02--vegetazt))
- Content Coin IPFS :: [`ipfs://bafkreihmbk7jb2ktw5oq4yios3lz3ojr564olawfiq4unn3xsjlbdi7x54`](https://ipfs.io/ipfs/bafkreihmbk7jb2ktw5oq4yios3lz3ojr564olawfiq4unn3xsjlbdi7x54)
- Content Coin Owners
  - `0x58613872F8eC8623A6D9041eF8422946D7327E40` (User, goku.ZT)
  - `0x646DE5f446c1287bF41B737BA541318EF97aF222` (Admin)
- Zora Link :: https://zora.co/coin/base:0x12118f0cb58fda162b407a9f02242d15415262ec

### Final Thoughts

Not sure what more can be done here. Although, the one thing missing from this flow is the Zora 
Account contract. Perhaps I need to first create a Zora Account, and have that Account be the main 
owner of the Creator Coin, which would make everything display correctly on the platform.

## Run Logs
> For [run-1755881862](../broadcast/Category1A.s.sol/8453/run-1755881862.json)

**Command**

```sh
$ source .env
$ forge script script/Category1A.s.sol \
> --rpc-url $BASE_RPC_URL \
> --broadcast \
> --verify \
> --etherscan-api-key $ETHERSCAN_API_KEY \
> --private-key $PRIV_KEY
```

**Logs**

```txt
== Logs ==
  ==== Running Category 1A Script ====
  ---- Hardcoded static poolconfig ----
  Deployer ::  0x66E9e64D743B7678331B1617Bf67b238897E04F8
  === Setup Admin and UserFactory ===
  Admin ::  0x646DE5f446c1287bF41B737BA541318EF97aF222
  UserFactory ::  0xE0fa3a53ebA5686D39a102abCC4b4805eE7eCe36
  === Create the two users ===
  --- Goku ---
  User ::  0xc66c986AfecE1825027597deCC92363CebBF1101
  Creator Coin ::  0xc66Ab166e5a4c67c95ecbF62F728EE437cB7a78B
  Creator IPFS ::  ipfs://bafkreibzd3meziylhx26cdarwtvgmbjh6lxt3ecdkyfvw4kbx36wccmmm4
  Creator Name ::  goku.ZT
  --- Vegeta ---
  User ::  0x58613872F8eC8623A6D9041eF8422946D7327E40
  Creator Coin ::  0xFe43EbeFfcef6cC166f00959588bCeefAd71f821
  Creator IPFS ::  ipfs://bafkreibvdwmqdcvy3fjvirj63rh72boo3jwgo4jffiimydi5djlefjblt4
  Creator Name ::  vegeta.ZT
  === Award Content Coins to Users ===
  --- Content 01 ---
  Coin ID ::  1
  Awarded to :: 0xc66c986AfecE1825027597deCC92363CebBF1101
  Content Coin ::  0x4d237f6D484E9ADBA7B1f1c656A718a47379C67f
  Content IPFS ::  ipfs://bafkreiglz4kleybyya5itsicek3nkpvzo5dz7jc3zc5j5xim7wkqewhc6a
  Content Name ::  ZT-00001
  --- Content 02 ---
  Coin ID ::  2
  Awarded to :: 0x58613872F8eC8623A6D9041eF8422946D7327E40
  Content Coin ::  0x12118f0Cb58fDa162B407A9F02242D15415262EC
  Content IPFS ::  ipfs://bafkreihmbk7jb2ktw5oq4yios3lz3ojr564olawfiq4unn3xsjlbdi7x54
  Content Name ::  ZT-00002
  ==== Category 1A Script complete ====

## Setting up 1 EVM.

==========================

Chain 8453

Estimated gas price: 0.032082482 gwei

Estimated total gas used for script: 34084799

Estimated amount required: 0.001093524950391118 ETH

==========================

##### base
✅  [Success] Hash: 0xa9a149eef4c38cb612c0ab00c0637f70e07d2df0a494df5845aca5cd4374638f
Block: 34546213
Paid: 0.000096424227434608 ETH (5830871 gas * 0.016536848 gwei)


##### base
✅  [Success] Hash: 0x9ea079bd187419451a16f94e4fe0a7b01f4e560b34f0ce666e2beea1fd370098
Block: 34546213
Paid: 0.000000775280507936 ETH (46882 gas * 0.016536848 gwei)


##### base
✅  [Success] Hash: 0x5ad3e5d57e8e00daa5d74e5ed36b3477848e8c1bea1d6dfdadddf30c703d78e3
Contract Address: 0x646DE5f446c1287bF41B737BA541318EF97aF222
Block: 34546213
Paid: 0.000030056002366416 ETH (1817517 gas * 0.016536848 gwei)


##### base
✅  [Success] Hash: 0x32e041cf4ebc6d5df757a644623f7212467373f0cf9e3f9712e97b12351dc410
Contract Address: 0xE0fa3a53ebA5686D39a102abCC4b4805eE7eCe36
Block: 34546213
Paid: 0.000027489748146384 ETH (1662333 gas * 0.016536848 gwei)


##### base
✅  [Success] Hash: 0x316d52777939cf681733bd101a52677c814c4d9777a82e5022a9639ee8ca233b
Block: 34546213
Paid: 0.00009642462431896 ETH (5830895 gas * 0.016536848 gwei)


##### base
✅  [Success] Hash: 0x5e317d95d29ac547e11ab572c61468aafb6a368d71c52e504d57e233062f66a7
Block: 34546213
Paid: 0.000077971006804128 ETH (4714986 gas * 0.016536848 gwei)


##### base
✅  [Success] Hash: 0xb8b74db5bb15b95746f19e2b52d2c97b70bbea27a24c0e1567b539b9ba9a0476
Block: 34546213
Paid: 0.000077688226703328 ETH (4697886 gas * 0.016536848 gwei)

✅ Sequence #1 on base | Total Paid: 0.00040682911628176 ETH (24601370 gas * avg 0.016536848 gwei)
                                                                                                                                                                                                                                   

==========================

ONCHAIN EXECUTION COMPLETE & SUCCESSFUL.
Warning: We haven't found any matching bytecode for the following contracts: [0xc66ab166e5a4c67c95ecbf62f728ee437cb7a78b, 0xfe43ebeffcef6cc166f00959588bceefad71f821, 0x4d237f6d484e9adba7b1f1c656a718a47379c67f, 0x12118f0cb58fda162b407a9f02242d15415262ec].

This may occur when resuming a verification, but the underlying source code or compiler version has changed.
##
Start verification for (4) contracts
Start verifying contract `0x646DE5f446c1287bF41B737BA541318EF97aF222` deployed on base
EVM version: cancun
Compiler version: 0.8.29
Constructor args: 000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000025a54000000000000000000000000000000000000000000000000000000000000

Submitting verification for [src/Admin.sol:Admin] 0x646DE5f446c1287bF41B737BA541318EF97aF222.
Warning: Could not detect the deployment.; waiting 5 seconds before trying again (4 tries remaining)

Submitting verification for [src/Admin.sol:Admin] 0x646DE5f446c1287bF41B737BA541318EF97aF222.
Warning: Could not detect the deployment.; waiting 5 seconds before trying again (3 tries remaining)

Submitting verification for [src/Admin.sol:Admin] 0x646DE5f446c1287bF41B737BA541318EF97aF222.
Submitted contract for verification:
        Response: `OK`
        GUID: `7nz8cvbwyskg1dufwt8xtsmswnxm6ihdrgtzzqvvrzs2da8rga`
        URL: https://basescan.org/address/0x646de5f446c1287bf41b737ba541318ef97af222
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Warning: Verification is still pending...; waiting 15 seconds before trying again (7 tries remaining)
0.001093524950391118Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
Start verifying contract `0xE0fa3a53ebA5686D39a102abCC4b4805eE7eCe36` deployed on base
EVM version: cancun
Compiler version: 0.8.29
Constructor args: 000000000000000000000000646de5f446c1287bf41b737ba541318ef97af222

Submitting verification for [src/user/UserFactory.sol:UserFactory] 0xE0fa3a53ebA5686D39a102abCC4b4805eE7eCe36.
Submitted contract for verification:
        Response: `OK`
        GUID: `nze2vsy36rha29sdsdwvhvfj5mvkuy8rqbearan7xfmpusvi7w`
        URL: https://basescan.org/address/0xe0fa3a53eba5686d39a102abcc4b4805ee7ece36
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Warning: Verification is still pending...; waiting 15 seconds before trying again (7 tries remaining)
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
Start verifying contract `0xc66c986AfecE1825027597deCC92363CebBF1101` deployed on base
EVM version: cancun
Compiler version: 0.8.29
Constructor args: 000000000000000000000000646de5f446c1287bf41b737ba541318ef97af222

Submitting verification for [src/user/User.sol:User] 0xc66c986AfecE1825027597deCC92363CebBF1101.
Submitted contract for verification:
        Response: `OK`
        GUID: `4rigyq693qcv1v9fcydzwccuvdi71ttwix7yyuw9khnqtbktpw`
        URL: https://basescan.org/address/0xc66c986afece1825027597decc92363cebbf1101
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Warning: Verification is still pending...; waiting 15 seconds before trying again (7 tries remaining)
Contract verification status:
Response: `OK`
Details: `Pass - Verified`
Contract successfully verified
Start verifying contract `0x58613872F8eC8623A6D9041eF8422946D7327E40` deployed on base
EVM version: cancun
Compiler version: 0.8.29
Constructor args: 000000000000000000000000646de5f446c1287bf41b737ba541318ef97af222

Submitting verification for [src/user/User.sol:User] 0x58613872F8eC8623A6D9041eF8422946D7327E40.
Submitted contract for verification:
        Response: `OK`
        GUID: `8dqv8mvnsp9yddcc9u9ddftvt9yfqrygr2tljeywc2xqfgegzi`
        URL: https://basescan.org/address/0x58613872f8ec8623a6d9041ef8422946d7327e40
Contract verification status:
Response: `NOTOK`
Details: `Pending in queue`
Warning: Verification is still pending...; waiting 15 seconds before trying again (7 tries remaining)
Contract verification status:
Response: `NOTOK`
Details: `Already Verified`
Contract source code already verified
All (4) contracts were verified!
```